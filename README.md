# React + Vite 下载方式兼容性演示

本项目基于 React + Vite，旨在演示三种常见的前端文件下载实现方式在与后端下载 API 搭配使用时的表现差异：

- 一种方式可以兼容后端报错（避免页面跳转到报错地址）
- 另外两种方式则无法避免页面跳转到后端报错页面

## 项目目标

通过实际代码演示，帮助开发者理解不同前端下载实现方式的优缺点，尤其是在后端接口可能返回错误（如 404、500 或业务异常）的情况下，如何避免用户体验不佳的问题。

## 下载方式说明

### 1. 直接使用 a 标签的 href/download 属性

```jsx
default
<a href="后端下载API地址" download>下载文件</a>
```

- 优点：实现简单，浏览器原生支持。
- 缺点：如果后端返回错误（如 404、500 或返回 JSON 错误信息），浏览器会直接跳转到错误页面或下载错误内容，前端无法拦截和处理。

### 2. 使用 window.open 或 window.location

```js
window.open("后端下载API地址");
// 或
window.location = "后端下载API地址";
```

- 本质与 a 标签类似，遇到后端报错时同样会跳转或打开错误页面，无法拦截。

### 3. 推荐：通过 fetch/axios 请求后端，再用 Blob 触发下载

```js
fetch("后端下载API地址")
  .then(res => {
    if (res.ok) {
      return res.blob();
    } else {
      // 这里可以处理错误响应
      throw new Error("下载失败");
    }
  })
  .then(blob => {
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "文件名";
    a.click();
    window.URL.revokeObjectURL(url);
  })
  .catch(err => {
    // 这里可以给用户友好提示
    alert(err.message);
  });
```

- 优点：可以在前端判断响应内容，遇到后端报错时拦截并提示用户，避免页面跳转到报错地址。
- 缺点：实现稍复杂，需处理 Blob 和下载逻辑。

## 项目结构

- `src/App.jsx`：包含三种下载方式的演示代码
- 你可以通过页面上的按钮分别体验不同实现方式的效果

## 适用场景

适用于需要与后端下载 API 对接，并希望在前端优雅处理后端异常的场景。

## 方式对比一览表

| 对比项             | a标签 href         | window.open         | fetch + Blob         |
|--------------------|--------------------|---------------------|----------------------|
| 可拦截错误         | ✗                  | ✗                   | ✓                    |
| 受CORS影响         | ✗                  | ✗                   | ✓                    |
| 用户体验           | 原生下载/跳转      | 新窗口跳转（适中）  | 友好可控             |
| 支持自定义文件名   | 部分支持（需download属性） | ✗           | ✓                    |
| 兼容性             | 极好               | 极好                | 现代浏览器           |
| 支持大文件         | ✓                  | ✓                   | ✓                    |
| 支持进度/反馈      | ✗                  | ✗                   | ✓（可实现进度条）    |
| 实现复杂度         | 最低               | 低                  | 略高                 |

> 注：fetch + Blob 方式如目标服务器未设置CORS，会报错，且需自行处理文件名、进度、错误提示等。
